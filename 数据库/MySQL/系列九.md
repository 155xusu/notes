系列九外键的相关操作

**[sql]** [view plain](http://blog.csdn.net/estom_yin/article/details/52028868)
[copy](http://blog.csdn.net/estom_yin/article/details/52028868)

1.  \#第三十九课时

2.  \--外键操作

3.  \--作用：保证数据的一致性和完整性

4.  

5.  \--外键是表的一个特殊字段。被参照的表是主表，外键所在的字段的表为字表，是指外键的原则需要记住

6.  \--就是依赖于数据库中已存在的表的主键。外间的作用时间里该表与其附表的关联关系，

7.  \--附表中对记录做操作时，子表中与之对应的信息也应该有相应的改变。

8.  

9.  \--可以实现一对一或一对多的关系

10. \--父表和子表必须使用相同的存储引擎，而且禁止使用临时表

11. \--数据表的存储引擎智能为innodb

12. \--外键列和参照列必须具有相似的数据类型。其中数字的长度或是否为有符号位必须相同；而字符长度可以不同

13. \--外键列和参照列必须创建索引。如果外键列不存在索引的话，MySQL自动创建索引

14. 

15. 

16. 

17. \--实践操作，创建部门表（主表）

18. **CREATE** **TABLE** IF NOT EXISTS department (

19. id TINYINT UNSIGNED AUTO_INCREMENT **KEY**,

20. depName **VARCHAR**(20) NOT NULL **UNIQUE**

21. 

22. )ENGINE = INNODB;

23. 

24. **INSERT** department(depName)**VALUES**('teach'),

25. ('market'),

26. ('undergo'),

27. ('watch');

28. 

29. 

30. \--创建员工表（字表）

31. **CREATE** **TABLE** IF NOT EXISTS employee(

32. id **SMALLINT** UNSIGNED AUTO_INCREMENT **KEY**,

33. username **VARCHAR**(20) NOT NULL **UNIQUE**,

34. depId TINYINT UNSIGNED

35. )ENGINE = INNODB;

36. 

37. **INSERT** employee(username ,depId)**VALUES**('kin',1),

38. ('joe',2 ),

39. 

40. ('est',3),

41. ('bob',4),

42. ('tom',5);

43. 

44. \--内连接实现

45. **SELECT** e.id,e.username,d.depName **FROM**

46. employee **AS** e

47. JOIN

48. department **AS** d

49. **ON** e.depId = d.id;

50. 

51. \--删除watch部门,虽然部门没有了，但是子表中部门下的人仍然存在。

52. **DELETE** **FROM** department **WHERE** depName = 'watch';

53. \--所以以上内容都是不符合要求的

54. **DROP** **TABLE** department , employee;

55. 

56. \--下面是通过外键常见的表

57. **CREATE** **TABLE** IF NOT EXISTS department (

58. id TINYINT UNSIGNED AUTO_INCREMENT **KEY**,

59. depName **VARCHAR**(20) NOT NULL **UNIQUE**

60. 

61. )ENGINE = INNODB;

62. 

63. **INSERT** department(depName)**VALUES**('teach'),

64. ('market'),

65. ('undergo'),

66. ('watch');

67. 

68. 

69. \--创建员工表（字表）

70. **CREATE** **TABLE** IF NOT EXISTS employee(

71. id **SMALLINT** UNSIGNED AUTO_INCREMENT **KEY**,

72. username **VARCHAR**(20) NOT NULL **UNIQUE**,

73. depId TINYINT UNSIGNED

74. FOREINGN KYE(depId)**REFERENCES** department(id)

75. )ENGINE = INNODB;

76. 

77. **INSERT** employee(username ,depId)**VALUES**('kin',1),

78. ('joe',2 ),

79. ('est',3),

80. ('bob',4),

81. ('tom',5);

82. 

83. \--如果子表中有某个父表记录下的内容，则父表中不能执行删除操作

84. \--如果父表中没有相应的外键，子表在插入时所使用的外键超出父表所使用的范围，会报错

85. 

86. \#第四十课时

87. \--添加和删除外键的操作

88. 

89. \--添加外键

90. **ALTER** **TABLE** employee **DROP** **FOREIGN** **KEY** em_fk_dep;
    \--em_fk_dep是外键的索引

91. \--删除外键

92. **ALTER** **TABLE** employee **ADD** CONSTRANINT emp_fk_dep **FOREIGN**
    **KEY**(depId) **REFERENCES** department(id);

93. 

94. 

95. \--CASCADE:从附表中珊瑚或更新且自动删除或更新子表中匹配行

96. \--SET
    NULL:从附表中删除或更新行，并设置子表中的外键列为NULL。如果使用该选项，必须保证子表列没有指定NOT
    NULL

97. \--RESTRICT:拒绝对父表的删除和更新操作

98. \--NO ACTION:在MySQL中，与restrict关键字相同

99. 

100. 

101. \--创建员工表（字表）

102. \--ON DELETE CASCADE在删除的时候是及连的

103. \--ON UPDATE CASCADE在更新的时候是及连的

104. **CREATE** **TABLE** IF NOT EXISTS employee(

105. id **SMALLINT** UNSIGNED AUTO_INCREMENT **KEY**,

106. username **VARCHAR**(20) NOT NULL **UNIQUE**,

107. depId TINYINT UNSIGNED

108. FOREINGN KYE(depId)**REFERENCES** department(id) **ON** **DELETE**
    **CASCADE** ;

109. )ENGINE = INNODB;

110. 

111. **INSERT** employee(username ,depId)**VALUES**('kin',1),

112. ('joe',2 ),

113. ('est',3),

114. ('bob',4),

115. ('tom',5);

116. 

117. \--删除部门表中的一个部门

118. **DELETE** **FROM** department **WHERE** id = 1;

119. \--更新部门表中的数据

120. **UPDATE** department **SET** id = id = 10;

121. 

122. 

123. \#第四十一课时

124. \--联合查询

125. \--union 和union all

126. \--NNION 合并相同信息

127. **SELECT** username FORM employee **UNION** **SELECT** username **from**
    cms_user;

128. \--UNION ALL 不合并相同信息

129. **SELECT** username FORM employee **UNION** ALL **SELECT** username **from**
    cms_user;
