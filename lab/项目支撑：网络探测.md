## 多源异质协同探测策略
>  动态多源协同探测策略
要求、指标：针对不同目标、不同探测手段，协同探测策略不少于5种。具备内部网络节点自组织和协同分布式执行任务的能力，每个节点负载不超过原本负载的10%

## 1 任务安排

13号

上午：
完成已有的研究内容
完成任务目标的抽象

下午：
了解多段协同的负载均衡模型
思考通用化的负载均衡模型，使用最新技术，考虑当前研究的最优方案。

晚上：
对相关模型的具体了解（至少给出五个多端协同模型）

14号

决定采取的多端协同模型
结合任务目标进行论述

15号

探讨当前方法的合理性。

- 今天的任务应该首先自己臆想一套垃圾方案，然后去阅读别人的东西进行修改。本子上得东西，尽量多的用自己已经有的知识完善就好了。明天一天进行完善。开始吧，研究生生活。

## 2 《网络探测技术研究》已经有的研究内容

### 目标：
针对目标内网主动协同探测需求，建立内网自主探测模型；突破设备信息主动收集技术；突破内网限制区域突防技术；研制内网自主探测原型系统，实现目标内网自动化探测。

### 自主探测模型：
* 首先，根据自主探测模型，我们感知目标内网X态势。基于已有的经验我们可以分析出内网中的部分知识，如安防设备、主机的大致类型。
利用启发式探测方案生成技术自动生成探测方案。
在刚开始受控节点数量比较少的情况下，为保持探测隐蔽性，采用低频的探测手段，根据受控主机操作系统是Windows、Linux、IOS采用不同的收集手段；当受控设备数量到达阈值后，采用分布式策略加速探测。

* 其次，感知目标可攻破的形式。
根据网络关键信息基础设施及相关资产信息包括，如IP地址、资产名称、服务端口、协议名称、操作系统、设备类型、厂商属性、应用组件等，寻找目标设备的弱点，
选择武器库中的前锋武器（XSS、应用软件漏洞、操作系统漏洞、网络设备漏洞等）组成攻击方案。
针对目标内网X中的隔离区域，首先识别隔离器类型，根据不同隔离器类型，选择DMZ突防、网闸突防、物理隔离突防策略。

* 最后，根据感知的态势对方案进行评估，选择合适的攻击方案。经过混淆工具对攻击方案进行加密混淆，隐蔽传输至主控服务器ControlHost，再由主控服务器将攻击工具分发给不同受控节点，攻击同一网段的关键设备。在获取其他关键设备权限后，利用控守工具与主控服务器建立控制关系，迭代的向周围其他机器展开提权攻击，逐步完成对内网的探测活动。


### 多手段分布协同探测：

* 为提升内网探测自动化与自适应能力，研究内网自主探测体系结构与活动模型，根据系统科学及自组织对抗理论自主探测的组成活动划分为决策、组织、信息收集、区域突防、免杀逃逸、数据处理、可用评估共七项活动，并研究活动间的交互模型。自主探测模型是对执行体的运行机理建模，是设计自主探测原型系统的理论框架。

### 关键技术

1.	内网自主探测建模技术
为提升局域网探测的自动化与自适应能力，研究局域网自主探测体系结构与活动模型，根据系统科学及自组织对抗理论自主渗透的组成活动划分为决策和组织、数据处理、信息收集、区域突防、免杀逃逸和可用评估共七项活动，并研究活动间的交互模型。自主探测模型是对执行体的运行机理建模，是设计自主探测原型系统的理论框架。
2.	基于先验知识的启发式方案自生成技术
面对多个场景下的探测需求，研究基于先验知识的启发式方案自生成技术，利用先验知识，通过自主决策，结合主动探测与被动探测结合的方式完成探测。先通过已有知识库构建一颗包含探测目标及探测手段的决策树，表示初始方案，通过启发式方法对决策树进行搜索。探测过程中，根据实际结果不断更新决策树，不断迭代生成探测方案。

## 3 任务说明

### 关键词

* 协同、自组织、负载均衡、多端协同、群体协同
* 多目标
* 柔性作业调度
* 动态作业调度

### 任务目标：网络探测。

具体任务：

* 主机探测（主机发现、端口探测、服务和版本探测、操作系统探测）
* 拓扑探测（SNMP、ARP、Traceroute、DNS）

### 任务要求：
* 多源异质、群体协同、负载均衡、自组织分布式

## 4 模型抽象（问题抽象过程）

### 设备抽象：
* 主控服务器、受控设备、网络关键信息基础设施称为节点
* 节点属性信息包IP地址、资产名称、服务端口、协议名称、操作系统、设备类型、厂商属性、应用组件
* 主机、服务器、交换机等所有的网络设备抽象为网络节点。
* 网络节点，包含各种属性信息。（权限、操作系统、协议）
* 网络节点，包含实时变化的动态信息，例如当前节点的负载。可以通过属性计算函数进行更新（负载计算函数）
* 评估负载1.功能性测试。2. 抗压测试。
* 网络节点分为受控节点和非受控节点。受控节点表示能够接受控制节点执行控制任务，非空节点表示待渗透的节点。
* 网络节点之间存在各种依赖。使用二维矩阵描述网络节点之间的链接关系。数字表示依赖的类型。依赖的类型包括：直接连接、跨越交换机的链接、跨越路由器的链接、相互之间是否可信。
* 由节点组成的网络会随着被控节点的增多逐渐增加。节点之间的依赖关系也会动态更新。
* 一个节点也许有并行执行任务的能力。并不代表节点只能执行单一的任务。
* 节点上任务的执行应该通过性能控制函数，决定当前并行执行多少任务。节点的负载应该是节点执行能力与任务量的对比。

### 策略抽象：
* 文章中提到的方案：选择前锋武器（XSS、应用软件漏洞、操作系统漏洞、网络设备漏洞等）组成攻击方案。实际上得方案有端口扫描和漏洞提权。
* 策略的指定属于外部输入。其他模块会确定攻击的目标，给出攻击的手段，制定攻击的策略。
* 每一个策略可以分为多个原子任务，原子任务之间存在依赖。可以构成一个有向无环图。
* 每一个策略涉及多个受控节点。需要多个受控节点合作，完成攻击策略，达成攻击目标。
* 每个策略执行完成后，需要对策略和子任务进行评估，包括性能评估、有效性评估。这样可以通过对比，得到方案的优劣。


### 任务抽象：
* 每一个策略可以分为多个子任务、子过程执行，每个可以单独执行的子过程称为原子任务。原子任务不需要再进行分割，可以由单一节点完成。（如果可以再分则不称为原子任务）
* 原子任务之间相互依赖。必须某些任务先完成，某些任务后完成。某些任务的输出是某些任务的输入。任务之间的依赖可以用树表示。任务之间的依赖表示了任务的优先级。
* 原子任务之间可以没有相互依赖，比如端口扫描，可以分成十个任务，每个任务扫描各自范围的主机构成总的策略。
* 原子任务依赖特定的节点与节点依赖类型
* 原子任务具有初始的负载计算方法（负载初始化）
* 原子任务具有可迁移性。如果当前节点的负载过高或者不在满足其他动态属性要求时（通过动态属性计算获得），原子任务能够自动迁移到负载相对较低的网络节点。
* 任务是不断变换的。旧的原子任务会不断解决，新的原子任务也会不断添加到队列中
* 任务应该也有状态。执行中的任务，已经分配的任务。


## 4 任务调度模型（数学模型-动态柔性作业调度模型）
> flexible dynamic schduling based on ABC
> 解决第3部分提出的问题。

### 概述
原子任务----分配---->受控节点。
**实现原子任务在网络节点上得分配工作**。任务调度模型就是任务通过任务调度算法分配到网络节点中。

### 假设
* 内网自主探测模型，已经完成对当前网络的描述，包括主控节点、受控节点、目标节点。
* 基于先验知识的启发式方案自生成技术，已经完成攻击策略的描述，攻击策略包括采取的手段与攻击的目标节点。
* 假设探测策略、探测任务的具体内容不需要考虑。主要考虑的是如何把探测策略分割成可以在不同节点执行的任务。
* 任务一旦开始执行便不能被中断。直到执行完毕。

### 目标

> 任务调度模型中，是多目标任务分配。在普通的任务调度模型当中，多目标可能是指：时间成本最低、空间成本最低、调度预算最低等。

* 节点执行任务的负载均衡P。最大化可控节点利用率，降低任务执行时间。（每个节点都有任务可以做，执行时间最短）min{S^2{L(N)}}}所有节点的负载的方差最小？？？表示波动最小？这也行？让我思考一下。

### 输入

* 由攻击策略生成模块，提供攻击策略S。
* 由网络分析模块提供网络的节点N和网络节点之间的链接关系Rn(N)


### 约束

> 在任务调度模型中，存在着多种约束条件。
* 任务执行过程中，满足原子任务之间的计算依赖。B(Rt(T))
* 任务分配过程中，满足受控节点之间的链接依赖。B(Rn(N))
* 任务分配过程中，满足原子任务对受控节点属性的要求。可以是静态的，比如节点的权限、操作系统等。B(q(N)=>p(T))
* 任务分配过程中，满足原子任务对受控节点属性的要求。这种属性要求可能是动态变化的，如节点负载，这种动态变化的属性要给出动态属性计算函数。B(q(N)=>p(T))
* 节点的运行CPU负载不能超过给定的要求B(performance)>sum{C_i(Q(M(T)=执行中))}

> 这里应该是模型的概述
### 策略的数学模型
* S表示所有策略的集合

### 任务的数学模型
* T表示任务的集合
* q(T)表示任务相关的属性。任务的属性是不变的。
* Rt(T×T)代表任务之间的有向无环图，表示任务之间的依赖。任务依赖由策略分解函数提供。
* T=D(S)可以将策略分解称为有相关作用的任务集合。D是策略的分割算法，将一个完成的策略分割成多个不同的子任务，方便放到不同的子节点上执行。
* C(T)表示每个任务执行过程中占用CPU的时间

### 节点的数学模型
* N表示节点的集合。
* q(N)表示节点相关的属性。属性计算函数，包括静态属性和动态属性。
* Rn(N×N)表示节点之间的链接关系图，不同的数值表示两个节点之间不同的链接类型。包括信任连接、直接相连、跨越交换机相连、跨越路由器相连、不信任相连。
* Rnt(T,N)表示任务与节点类型之间的依赖关系。
* A(T,N)表示任务调度算法，将任务分配到指定的节点上。A(T,N)是任务与节点的映射

### 执行流程
1. 首先初始化策略、任务、节点的数学模型。然后输入外部的所有策略S与节点N包含节点之间Rn(N×N)。
2. 然后执行策略分割函数T=D(S)，将策略分为多个不同的原子任务T。同时，形成任务之间的依赖关系Rt(T×T)
3. 然后执行A(T,N)任务调度算法，满足所有的约束条件B，得到满足负载平衡的一个分配方案P。
4. 执行方案，将方案中的任务放到具体的计算节点上执行。
5. 执行过程中，会形成反馈信息，给执行的调用者。包含任务执行结果和任务执行后的状态。
6. 执行过程中，任务执行完成后会从任务集合T中消失，并更新R(T)。
7. A(T,N)是动态任务调度算法。当任务信息反馈给策略生成模块时，策略生成模块会根据最新反馈的信息，形成新的策略，并交付给任务调度模型。此时重新执行1-6的步骤，直到所有的策略执行完成，并且策略生成模块不再生成新的模块。形成新的任务、加入新的节点。

### 特点

* 柔性任务调度。一个任务由多个节点可以执行。一个节点可以执行多个任务。
* 动态任务调度。在任务调度中，节点与任务都是动态变化的。受控节点会不断增加，任务执行完成后会剔除，新的任务也会不断被添加到任务调度模型当中。
* 负载均衡。利用所有可以利用的节点。平摊任务。每个节点充分利用。
* 多目标多约束任务调度。在任务调度中目标应该是任务执行效率最高。但是有一大堆约束条件。负载均衡应该也算任务目标？还是约束条件。

### 辅助图解

1. 任务依赖图
2. 任务调度模型图
3. 任务调度算法图


## 5 任务调度算法（人工蜂群算法）

### 数学模型
> 应该对任务调度模型部分的数学模型进行抽象，添加一下可以用来做任务调度算法的性质或者函数，同时添加任务调度算法本身的数学抽象。

* F(T)表示每个任务的优先级。用来实现任务调度模型中的任务依赖关系Rt(T)
* Q(N)表示任务队列。每一个节点N都维护一个任务队列（或者是优先队列），所有节点上的Q(N)集合，即为任务分配算法形成的最新的任务分配方案P。（也就是说使用Q(N)实现了P的具体描述）
* M(T)表示任务的状态。任务状态包含队列中、执行中、执行结束。任务一旦处于执行中，便不能被收回。执行结束后，任务被销毁。
* L(T)表示当前节点任务节点的load负载计算函数。具体的计算函数应该后续给出。是否可以由每个任务占用CPU时间与估计的执行时间进行乘积计算？

### 算法原理

> 给出了一个实例处理这种问题，大部分研究都是使用粒子群算法的。
粒子群算法
* 粒子群编码
* 适应度函数定义
* 速度与位置更新
* 惯性权重的调整。

人工蜂群算法
人工蜂群算法就是模拟蜜蜂的采蜜过程而提出的一种新型智能优化算法，它也是由食物源、引领蜂、跟随蜂和侦查蜂组成。

食物源：食物源即为蜜源。在任何一个优化问题中，问题的可行解都是以一定形式给出的。在人工蜂群算法中，食物源就是待求优化问题的可行解，是人工蜂群算法中所要处理的基本对象。食物源的优劣即可行解的好坏是用蜜源花蜜量的大小即适应度来评价的。
引领蜂：引领蜂与食物源的位置相对应，一个食物源对应一个引领蜂。
跟随蜂：在蜂巢的招募区内根据引领蜂提供的蜜源信息来选择食物源
侦查蜂：侦查蜂是在蜂巢附近寻找新的食物源。

在人工蜂群算法中，食物源的个数与引领蜂的个数相等；引领蜂的任务是发现食物源信息并以一定的概率与跟随蜂分享；概率的计算即为人工蜂群算法中的选择策略，一般是根据适应度值以轮盘赌的方法计算。
在人工蜂群算法中，跟随蜂依据引领蜂传递的信息，在食物源附近搜索新食物源，并进行贪婪选择。若一个食物源在经过次后仍未被更新，则此引领蜂变成侦査蜂，侦查蜂寻找新的食物源代替原来的食物源。


### 算法流程
> 给出了粒子群算法的步骤

* 步骤1 初始化种群规模 NP、最大的迭代次数 Imax、学习因子 c1， c2、惯性权重范围［ωmin， ωmax］等 参数。 
* 步骤2 在约束范围内，以正态分布的方式初始 化可行粒子，并且随机产生可行粒子的位置和速度， 确定局部最优解 pbest 和全局最优解 gbest。 
* 步骤3 按式( 6) 计算每个可行粒子的适应度 函数值。 
* 步骤4 对于每个可行粒子，将其适应度函数值 与局部最优解 pbest 进行比较，如果优于 pbest，则将 当前值设为 pbest。 
* 步骤5 对于每个可行粒子，将其适应度函数值 与全局最优解 gbest 进行比较，如果优于 gbest，则将 当前值设为 gbest。 
* 步骤6 根据式( 7) 更新每个粒子的速度。 
* 步骤7 根据式( 8) 和式( 9) 更新每个粒子的 位置。 
* 步骤8 如果迭代次数达到最大值 Imax，则转 步骤9，否则转步骤3 继续下一次迭代。 
* 步骤9 输出局部最优解 pbest 和全局最优解 gbest。 


> 给出了人工蜂群算法的步骤

* 步骤1：初始化种群：初始化各个参数，蜂群总数SN、食物源被采集次数即最大迭代次数MCN及控制参数limit，确定问题搜索范围，并且在搜索范围内随机产生初始解xi(i=1,2,...SN) 。

* 步骤2：计算并评估每个初始解的适应度。

* 步骤3：设定循环条件并开始循环

* 步骤4：引领蜂对解xi按照式（2-3）进行邻域搜索产生新解（食物源）vi，并计算其适应度值；

* 步骤5：按照式(2-7)进行贪婪选择：如果vi的适应度值优于xi，则利用vi替换xi，将vi作为当前最好的解，否则保留xi不变；

* 步骤6：根据式(2-4)计算食物源的概率pi；

* 步骤7：跟随蜂依照概率pi选择解或食物源，按照式(2-3)搜索产生新解（食物源）vi，并计算其适应度。

* 步骤8：按式(2-7)进行贪婪选择；如果vi的适应度优于xi，则用vi代替xi，将vi作为当前最好解，否则保留xi不变；

* 步骤9：判断是否有要放弃的解。若有，则侦查蜂按式(2-5)随机产生新解将其替换；

* 步骤10：记录到目前为止的最优解；

* 步骤11：判断是否满足循环终止条件，若满足，循环结束，输出最优解，否则返回步骤4继续搜索。

### 步骤

* 维护一个节点依赖矩阵
* 维护一个任务依赖矩阵（从任务的有向无环图生成树，叶节点优先级最高，根节点优先级最低）
* 使用优先队列存储任务节点。（当任务分配时，检验任务依赖是否满足，不满足则任务降级，瓶颈依赖升级）
* 使用群体之能算法完成多个节点的优先队列构建。随着执行，各个节点的优先队列会动态变化。优先队列的任务之间会相互迁移。
* 优先队列是待执行任务，主控节点会根据节点当前的性能限制分配并行执行的任务数量。


> 关于负载需要说明：负载不是计算资源耗费的量计算。而是通过一个计算机当前执行任务的能力与分配给当前计算机的任务的量的一种关系，能力低，任务多，节点的负载很高。能力低，任务少，节点的负载很低。
> 负载均衡是多个节点之间的待分配任务的平衡。性能限制是当前计算节点执行任务量的限制。

> 通过以上简单的几个步骤，应该就可以实现，负载均衡、性能控制。那么剩下的主要为题就是-------这个所谓的群体智能算法如何任务分配。


## 6 关键技术（给出一些图）

## 7 技术路线（给出一些图）    

### 任务抽象过程描述
首先描述问题的抽象过程。讲整个任务调度模型中的角色分为三种，包括节点、策略、任务。（根据策略、任务、节点的抽闲过程进行描述）描述这是一个怎样的系统

### 任务调度模型描述
本文提出的任务调度模型，以任务执行效率最高为目标。任务调度的目标是在任务依赖的情况下，尽可能最大化利用计算节点，提高执行效率。

使用任务依赖、节点依赖、任务与节点之间的依赖、节点性能约束等外部约束来分别约束任务调度，要求任务调度方案中的所有任务调度到到节点上满足要求的依赖，



### 任务调度算法描述
然后介绍任务调度模型的核心。任务调度算法的实现。
