
# 内容简介
> springboot本就是一个专门用来配置的框架，用来整合各种各样的配置。所以主要内容也是与配置相关。
> * 配置文件
> * web开发
> * 数据访问
> * 但愿测试
> * 指标监控
> * 核心原理
> 。。。

## 1 springboot背景
springboot + springcloud
### 微服务
1. 架构风格
2. 小型服务，灵活拆分
3. 自动部署
4. 去中心化、服务治理


### 分布式
1. 远程调用rpc——http
2. 服务发现——网关和注册中心
3. 负载均衡和任务调度
4. 服务容错——流量控制和熔断
5. 配置管理——配置中心
6. 服务监控
7. 链路追踪
8. 日志管理


### 云原生

1. 服务自愈
2. 弹性伸缩
3. 服务隔离
4. 自动化部署机制
5. 灰度发布，逐渐替代旧版本
6. 流量治理



## 2 springboot概述

### 基本概念
Spring Boot 是基于 Spring 框架基础上推出的一个全新的框架, 旨在让开发者可以轻松地创建一个可独立运行的，生产级别的应用程序。利用控制反转的核心特性，并通过依赖注入实现控制反转来实现管理对象生命周期容器化，利用面向切面编程进行声明式的事务管理，整合多种持久化技术管理数据访问，提供大量优秀的Web框架方便开发等等。

> [参考文献](https://www.yuque.com/atguigu/springboot/na3pfd)


### 框架优势

1. 能够轻松、方便地创建一个 Spring 应用;
2. 直接使用内嵌的 Tomcat, Jetty, Undertow 容器（无需再手动安装容器，通过部署 WAR 包的方式）;
3. 内部自动管理各种 Jar 包的版本依赖关系，再也不用为版本冲突而烦恼啦；
4. 自动化配置 Spring 相关功能，以及第三方库;
5. 提供诸如指标，健康检查, 外部化配置等功能；
6. "零配置"，再也不需要手写地狱般的 XML 配置了；


#### 框架特点

* REST风格
* IOC控制反转
* AOP面向切面

## 3 操作入门

### maven设置
* 配置maven的Aliyun镜像和jdk版本
```xml
<mirrors>
      <mirror>
        <id>nexus-aliyun</id>
        <mirrorOf>central</mirrorOf>
        <name>Nexus aliyun</name>
        <url>http://maven.aliyun.com/nexus/content/groups/public</url>
      </mirror>
  </mirrors>
 
  <profiles>
         <profile>
              <id>jdk-1.8</id>
              <activation>
                <activeByDefault>true</activeByDefault>
                <jdk>1.8</jdk>
              </activation>
              <properties>
                <maven.compiler.source>1.8</maven.compiler.source>
                <maven.compiler.target>1.8</maven.compiler.target>
                <maven.compiler.compilerVersion>1.8</maven.compiler.compilerVersion>
              </properties>
         </profile>
  </profiles>
```


### 创建maven工程

```
mvn archetype:generate
```

### 引入依赖

```
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>2.3.4.RELEASE</version>
</parent>


<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

</dependencies>
```

### 创建主程序

```java
/**
 * 主程序类
 * @SpringBootApplication：这是一个SpringBoot应用
 */
@SpringBootApplication
public class MainApplication {

    public static void main(String[] args) {
        SpringApplication.run(MainApplication.class,args);
    }
}
```


### 编写业务逻辑

```java
@RestController
public class HelloController {


    @RequestMapping("/hello")
    public String handle01(){
        return "Hello, Spring Boot 2!";
    }


}
```


### 测试

直接运行main方法


### 配置

application.properties

```
server.port=8888
```

### 简化部署

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
    </plugins>
</build>
```


## 4 工程结构

### 推荐工程结构
```
com
  +- example
    +- myproject
      +- Application.java
      |
      +- domain
      |  +- Customer.java
      |  +- CustomerRepository.java
      |
      +- service
      |  +- CustomerService.java
      |
      +- web
      |  +- CustomerController.java
      |
```
* root package：com.example.myproject，所有的类和其他package都在root package之下。
* 应用主类：Application.java，该类直接位于root package下。通常我们会在应用主类中做一些框架配置扫描等配置，我们放在root package下可以帮助程序减少手工配置来加载到我们希望被Spring加载的内容
* com.example.myproject.domain包：用于定义实体映射关系与数据访问相关的接口和实现
* com.example.myproject.service包：用于编写业务逻辑相关的接口与实现
* com.example.myproject.web：用于编写Web层相关的实现，比如：Spring MVC的Controller等

> Spring Boot的应用主类会自动扫描root package以及所有子包下的所有类来进行初始化。


### 非典型结构下的初始化

1. 使用@ComponentScan注解指定具体的加载包

```java
@SpringBootApplication
@ComponentScan(basePackages="com.example")
public class Bootstrap {

    public static void main(String[] args) {
        SpringApplication.run(Bootstrap.class, args);
    }

}
```
2. 使用@Bean注解来初始化。在主类中进行初始化。
```java
@SpringBootApplication
public class Bootstrap {

    public static void main(String[] args) {
        SpringApplication.run(Bootstrap.class, args);
    }

    @Bean
    public CustomerController customerController() {
        return new CustomerController();
    }

}
```


## 5 自动配置原理

### maven继承关系
* 在parent中管理版本信息
```xml
依赖管理    
<parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.3.4.RELEASE</version>
</parent>

他的父项目
 <parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-dependencies</artifactId>
    <version>2.3.4.RELEASE</version>
  </parent>

几乎声明了所有开发中常用的依赖的版本号,自动版本仲裁机制
```